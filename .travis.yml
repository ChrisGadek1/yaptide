language: go
go:
  - master
env: 
  - TRAVIS_NODE_VERSION="node"
before_install:
  - openssl aes-256-cbc -K $encrypted_0532213be6b0_key -iv $encrypted_0532213be6b0_iv -in deploy_key.enc -out /home/travis/.ssh/deploy_key -d
  - chmod 600 /home/travis/.ssh/deploy_key
install:
  - rm -rf ~/.nvm && git clone https://github.com/creationix/nvm.git ~/.nvm && (cd ~/.nvm && git checkout `git describe --abbrev=0 --tags`) && source ~/.nvm/nvm.sh && nvm install $TRAVIS_NODE_VERSION
  - go get -u github.com/alecthomas/gometalinter
  - go get -u github.com/kardianos/govendor
  - gometalinter --install --force
  - npm install
  - cd $HOME/gopath/src/github.com && mv wkozyra95 Palantir && cd Palantir/palantir 
  - export TRAVIS_BUILD_DIR=$HOME/gopath/src/github.com/Palantir/palantir
  - govendor sync
  - ./build_tools/release.sh
script:
  - ./run.sh check
deploy:
  - provider: script
    script: build_tools/deploy.sh 
    skip_cleanup: true
    on:
      all_branches: true
